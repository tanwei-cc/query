/**
* "query" JavaScript CSS Selector Engine
* Copyright (c) 2012 tanwei
* Version: 1.0
* Download: http://tanwei-cc.github.com/query/
* Blog: http://www.cnblogs.com/weishao/
* Date:2012/10/14
*/
(function(a){var b=a.document,c=b.querySelectorAll,d=/^([\w-]+)?#([\w-]+)/,e=/^([\w-]+)?\.([\w-]+)/,f=/^([\w-]+)?\[([\w]+)([|*~\$!]*)(?:=(?:['"]?)(\w+)(?:['"]?))?\]/,g=/^([\w-#.]+)(?:[ ]*)(\>)(?:[ ]*)([\w#.-]+)/;var query=function(v,w){w=w||b;var x=[];if(c)x=w.querySelectorAll(v);else{var z=v.split(',');m(v.split(','),function(A){x=x.concat(h(A,w))})};var y=x&&x.length;return(y&&y==1)?x[0]:l(x)};function h(v,w){var x=[],y=v.match(g);if(y)return i(y,w);y=v.split(/[ ]+/);var z=j(y[0],w);if(!y[1])return z;m(z,function(A){x=x.concat(j(y[1],A))});return x};function i(v,w){var x=[];m(j(v[1]),function(y){m(y.childNodes,function(z){if(z.nodeType==1&&(z.tagName==v[3].toUpperCase()||"#"+z.id==v[3]||n(z.className,v[3].replace('.',''))))x.push(z)})});return x};function j(v,w){var x=[],y=v.match(e),z=!y&&v.match(d),A=!z&&v.match(f);if(z){var B=q(z[2],z[1]);if(B)x.push(B)}else if(y)x=u(y[2],w,y[1]);else if(A)x=r(A[2],A[4],w,A[1],A[3]);else x=t(v,w);return k(x)};function k(v){var w=[];try{return Array.prototype.slice.call(v)}catch(e){m(v,function(x){w.push(x)})};return w};function l(v){var w=[],x=+new Date;m(v,function(y){if(!y[x]){w.push(y);y[x]=1}});m(w,function(y){y.removeAttribute(x)});return w};function m(v,w){if(v)for(var x=0,l=v.length;x<l;x++)w(v[x],x)};function n(v,w){return RegExp("\\b"+w+"\\b").test(v);};function o(v,w){for(var x in w)v[x]=w[x];return v};function p(v){if(typeof v=="string")return b.getElementById(v);return v||b};function q(v,w){var x=p(v);if(w&&x&&x.tagName!=w.toUpperCase())return null;return x};function r(v,w,x,y,z){if(v=='class')v='className';var A=[],B=w?w.length:0,C=!w?-1:(!z?0:' |*~$!'.indexOf(z));m(t(y,x),function(D){var E=D[v]||D.getAttribute(v);if(D.nodeType==1&&E){var F=[true,E==w,E.substr(0,B)==w,E.indexOf(w)>-1,n(E,w),E.substr(E.length-B)==w,E!=w];if(F[C+1])A.push(D)}});return A};function s(v){return b.getElementsByName(v)};function t(v,w){v=v||"*";return p(w).getElementsByTagName(v)};function u(v,w,x){if(c)p(w).querySelectorAll((x||"")+"."+v);return r("class",v,w,x,'~')};o(query,{extend:function(v){o(query,v)},getById:q,getByAttr:r,getByName:s,getByTagName:t,getByClass:u});a.query=query})(window);